<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Simon</title>
    <style>
        body {
            background-color: lightslategrey;
            background-image: url("img/gcjill.jpg");
            background-repeat: no-repeat;
            background-size: 100%, 100%;
        }
        #buttonscontainer{
            position:relative;
            width: 80%;
            height: 80%;
            margin: auto;
        }
        div {
            position: absolute;
            height: auto;
            width: auto;
            max-width: 50%;
            max-height: 100%;
            margin: 0;
            color: white;
        }
        #red {
            top: 0;
            left: 0;
        }
        #green {
            top: 0;
            left: 50%;
        }
        #blue {
            top: 50%;
            left: 0;
        }
        #yellow {
            top:50%;
            left: 50%;
        }
        button {
            margin-left: 25%;
            width: 50%;
            height: 20%;
            font-size: 15vh;
        }
        #backgroundsquares {
            height: auto;
            width: auto;
            max-width: 100%;
            max-height: 100%;
            z-index: -1;
        }
        img {
            width: 100%;
            height: 100%;
        }
        audio {
            float: right;
            width: 400px;
        }
        #cbam {
            font-size: 12px;
            color: white;
        }
        #dranks {
            position: relative;
            float:left;
            width: 50%;
        }
        #dranks div {
            position: relative;
            height: auto;
            width: auto;
            max-width: 20%;
            max-height: 20%;
            color: white;
            float: left;
        }
        #display {
            position: relative;
            float: right;
            width: 45%;
            background-color: lightslategrey;
            padding-left: 5px;
        }
        #display div {
            position:relative;
            color: white;
            font-size: 2em;
            margin-bottom: 2em;
        }
        #display button {
            display: inline;
            width: 50%;
            margin: 0;
        }
        #radelhyde {
            color: red;
        }
        #ybronson {
            color: yellow;
        }
        #bdelta {
            color: blue;
        }
        #gflanergide {
            color: green;
        }
        #ltbluekarmotrine {
            color: lightblue;
        }
        .count {
            font-size: 3em;
        }
    </style>
</head>
<body>
<audio id="music" loop preload controls src="sounds/KarmotrineDream.mp3"></audio>

<!-- Simon -->

<div id="buttonscontainer">
    <img id="backgroundsquares" src="img/squares.png">
    <div id="red"><img src="img/red.png"></div>
    <div id="green"><img src="img/green.png"></div>
    <div id="blue"><img src="img/blue.png"></div>
    <div id="yellow"><img src="img/yellow.png"></div>
</div>
<button id="start">Start</button>

<!-- Super less than secret second game! :O -->

<h1 id="cbam">Cyberpunk Bartender Action Mode</h1>
<div id="dranks">
    <div id="adelhyde">
        <div class="count">Adelhyde</div>
        <img src="img/adelhyde.png" alt="">
        <div id="adelhydecount" class="count">0</div>
    </div>
    <div id="bronson">
        <div class="count">Bronson Extract</div>
        <img src="img/bronsonextract.png" alt="">
        <div id="bronsoncount" class="count">0</div>
    </div>
    <div id="delta">
        <div class="count">Powdered Delta</div>
        <img src="img/powdereddelta.png" alt="">
        <div id="deltacount" class="count">0</div>
    </div>
    <div id="flanergide">
        <div class="count">Flanergide</div>
        <img src="img/flanergide.png" alt="">
        <div id="flanergidecount" class="count">0</div>
    </div>
    <div id="karmotrine">
        <div class="count">Karmotrine</div>
        <img src="img/karmotrine.png" alt="">
        <div id="karmotrinecount" class="count">0</div>
    </div>
    <div id="rocks"><img src="img/rocks.png" alt=""></div>
    <div id="age"><img src="img/age.png" alt=""></div>
    <div id="mixed"><img src="img/mixer.png" alt=""></div>
    <div id="blended">blend</div>
</div>
<div id="display">
    <button id="left">left</button><button id="right">right</button>
    <div id="id"></div>
    <div id="drink"></div>
    <div id="recipe"></div>
    <div id="description"></div>
    <div id="tags"></div>
</div>


<script src="js/recipes.js"></script>
<script src="js/howler.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script>
        var randomized = '';
        var entered = '';
        var clickable = false;
        var score = 0;
        var red = $('#red');
        var blue = $('#blue');
        var green = $('#green');
        var yellow = $('#yellow');
        var background = $('#backgroundsquares');
        var start = $('#start');

        dranks.fadeOut(0);
        display.fadeOut(0);



        var sound = new Howl({
            src: ['sounds/soundsprite.ogg'],
            sprite: {
                error: [0, 1500],
                red: [2000, 2000],
                blue: [4000, 2500],
                green: [7000, 1000],
                yellow: [8000, 2000]
            }
        });


        var music = document.getElementById('music');
        setTimeout(function(){music.play()}, 1000);
        music.volume = 0.6;

        var randomizer = function(){return Math.floor(Math.random() * 4)};

        start.click(function(){
            randomized = '';
            alert("Starting now!");
            animateOld();
        });
        red.click(function(){
            if(clickable == false) {
            } else {
                entered += "r";
                red.fadeOut(100).fadeIn(100);
                clickable = false;
                if(entered.substring(0) != randomized.substring(0, entered.length)){
                    entered = '';
                    randomized = '';
                    sound.play('error');
                    alert("You lose! Score: "+ score + " || Try again.");
                    score = 0;
                } else if (entered == randomized) {
                    sound.play('red');
                    setTimeout(function(){animateOld();}, 1500);
                    entered = '';
                    score ++;
                } else {
                    sound.play('red');
                    clickable = true;
                }
            }
        });
        blue.click(function(){
            if(clickable == false) {
            } else {
                entered += "b";
                blue.fadeOut(100).fadeIn(100);
                clickable = false;
                if(entered.substring(0) != randomized.substring(0, entered.length)){
                    entered = '';
                    randomized = '';
                    sound.play('error');
                    alert("You lose! Score: "+ score + " || Try again.");
                    score = 0;
                } else if (entered == randomized) {
                    sound.play('blue');
                    setTimeout(function(){animateOld();}, 1500);
                    entered = '';
                    score ++;
                } else {
                    sound.play('blue');
                    clickable = true;
                }
            }
        });
        green.click(function(){
            if(clickable == false) {
            } else {
                entered += "g";
                green.fadeOut(100).fadeIn(100);
                clickable = false;
                if(entered.substring(0) != randomized.substring(0, entered.length)){
                    entered = '';
                    randomized = '';
                    sound.play('error');
                    alert("You lose! Score: "+ score + " || Try again.");
                    score = 0;
                } else if (entered == randomized) {
                    sound.play('green');
                    setTimeout(function(){animateOld();}, 1500);
                    entered = '';
                    score ++;
                } else {
                    sound.play('green');
                    clickable = true;
                }
            }
        });
        yellow.click(function(){
            if(clickable == false) {
            } else {
                entered += "y";
                yellow.fadeOut(100).fadeIn(100);
                clickable = false;
                if(entered.substring(0) != randomized.substring(0, entered.length)){
                    entered = '';
                    randomized = '';
                    sound.play('error');
                    alert("You lose! Score: "+ score + " || Try again.");
                    score = 0;
                } else if (entered == randomized) {
                    sound.play('yellow');
                    setTimeout(function(){animateOld();}, 1500);
                    entered = '';
                    score ++;
                } else {
                    sound.play('yellow');
                    clickable = true;
                }

            }
        });


        function rgby() {
            var random = randomizer();
            console.log(random);
            if(random == 0){
                randomized += 'r';
            } else if (random == 1) {
                randomized += 'g';
            } else if (random == 2) {
                randomized += 'b';
            } else {
                randomized += 'y';
            }
            console.log('randomized = ' + randomized);
        }
        function animateOld() {
            var i = 0;
            rgby();
            var IntervalOne = setInterval(function () {
                console.log("i = " + i);
                console.log(randomized.charAt(i));
                var color = randomized.charAt(i);
                if (randomized.charAt(i) == 'r') {
                    console.log("animating red");
                    red.fadeOut(300).fadeIn(300);
                    sound.play('red');
                } else if (randomized.charAt(i) == 'g') {
                    console.log("animating green");
                    green.fadeOut(300).fadeIn(300);
                    sound.play('green');
                } else if (randomized.charAt(i) == 'b') {
                    console.log("animating blue");
                    blue.fadeOut(300).fadeIn(300);
                    sound.play('blue');
                } else if (randomized.charAt(i) == 'y') {
                    console.log("animating yellow");
                    yellow.fadeOut(300).fadeIn(300);
                    sound.play('yellow');
                } else {
                    console.log("WTF is happening? color " + color + " i " + i);
                }
                if (i == randomized.length - 1) {
                    clearInterval(IntervalOne);
                    clickable = true;
                } else {
                    i++;
                }
            }, 800);
        }

//        Start Variables for second game

        var dranks = $('#dranks');
        var adelhyde = $('#adelhyde');
        var bronson = $('#bronson');
        var delta = $('#delta');
        var flanergide = $('#flanergide');
        var karmotrine = $('#karmotrine');
        var rocks = $('#rocks');
        var age = $('#age');
        var mixer = $('#mixed');
        var blend = $('#blended');
        var display = $('#display');
        var id = $('#id');
        var drink = $('#drink');
        var recipe = $('#recipe');
        var description = $('#description');
        var tags = $('#tags');
        var mix = [];
        var mixingdrinksandchanginglives = false;
        var left = $('#left');
        var right = $('#right');
        var i = 0;
        var cbam = $('#cbam');
        console.log(recipes);

//        Checks for instances of each ingredient in the current mixture

        function foo(arr) {
            var a = [], b = [], prev;

            arr.sort();
            for ( var i = 0; i < arr.length; i++ ) {
                if ( arr[i] !== prev ) {
                    a.push(arr[i]);
                    b.push(1);
                } else {
                    b[b.length-1]++;
                }
                prev = arr[i];
            }

            return [a, b];
        }

//        Initializes the second game - the entirety of the second game exists largely as a random decision of mine to give it a try.

        cbam.click(function(){
            if(mixingdrinksandchanginglives == false){
                mixingdrinksandchanginglives = true;
                red.fadeOut(500);
                blue.fadeOut(500);
                green.fadeOut(500);
                yellow.fadeOut(500);
                background.fadeOut(500);
                start.fadeOut(500);
                cbam.html("Cyberpunk Bartender Mode Engaged!");
                cbam.css("font-size", "50px");
                cbam.css("text-align", "center");
                dranks.fadeIn(1000);
                display.fadeIn(1000);
                id.html("ID: " + recipes[i].id);
                drink.html(recipes[i].name);
                recipe.html(recipes[i].recipeStr);
                description.html(recipes[i].description);
                tags.html(recipes[i].tags);
            } else if (mixingdrinksandchanginglives == true){
                mixingdrinksandchanginglives = false;
                red.fadeIn(1000);
                blue.fadeIn(1000);
                green.fadeIn(1000);
                yellow.fadeIn(1000);
                background.fadeIn(1000);
                start.fadeIn(1000);
                cbam.html("Ok, loser, <em>don't</em> play the game I painstakingly coded in. Meanie.")
                cbam.css("font-size", "15px");
                cbam.css("text-align", "left");
                dranks.fadeOut(500);
                display.fadeOut(500);
            }
        });

        left.click(function(){
            i--;
            id.html("ID: " + recipes[i].id);
            drink.html(recipes[i].name);
            recipe.html(recipes[i].recipeStr);
            description.html(recipes[i].description);
            tags.html(recipes[i].tags);
        });
        right.click(function(){
            i++;
            id.html("ID: " + recipes[i].id);
            drink.html(recipes[i].name);
            recipe.html(recipes[i].recipeStr);
            description.html(recipes[i].description);
            tags.html(recipes[i].tags);
        });

        adelhyde.click(function(){
            if(mixingdrinksandchanginglives == false){
            } else {
                var instances = foo(mix);
                console.log(instances[1]);
                var instance = instances[0];
                var number = instances[1];
                if(number[instance.indexOf("Adelhyde")] == 20) {
                    console.log("No more room for Adelhyde");
                    console.log(mix);
                } else{
                    console.log("Adding Adelhyde");
                    mix.push("Adelhyde");
                    console.log(mix);
                }
            }
        });

        bronson.click(function(){
            if(mixingdrinksandchanginglives == false){
            } else {
                var instances = foo(mix);
                console.log(instances[1]);
                var instance = instances[0];
                var number = instances[1];
                if(number[instance.indexOf("Bronson")] == 20) {
                    console.log("No more room for Bronson");
                    console.log(mix);
                } else{
                    console.log("Adding Bronson");
                    mix.push("Bronson");
                    console.log(mix);
                }
            }
        });

        delta.click(function(){
            if(mixingdrinksandchanginglives == false){
            } else {
                var instances = foo(mix);
                console.log(instances[1]);
                var instance = instances[0];
                var number = instances[1];
                if(number[instance.indexOf("Delta")] == 20) {
                    console.log("No more room for Delta");
                    console.log(mix);
                } else{
                    console.log("Adding Delta");
                    mix.push("Delta");
                    console.log(mix);
                }
            }
        });

        flanergide.click(function(){
            if(mixingdrinksandchanginglives == false){
            } else {
                var instances = foo(mix);
                console.log(instances[1]);
                var instance = instances[0];
                var number = instances[1];
                if(number[instance.indexOf("Flanergide")] == 20) {
                    console.log("No more room for Flanergide");
                    console.log(mix);
                } else{
                    console.log("Adding Flanergide");
                    mix.push("Flanergide");
                    console.log(mix);
                }
            }
        });

        karmotrine.click(function(){
            if(mixingdrinksandchanginglives == false){
            } else {
                var instances = foo(mix);
                console.log(instances[1]);
                var instance = instances[0];
                var number = instances[1];
                if(number[instance.indexOf("Karmotrine")] == 20) {
                    console.log("No more room for Karmotrine");
                    console.log(mix);
                } else{
                    console.log("Adding Karmotrine");
                    mix.push("Karmotrine");
                    console.log(mix);
                }
            }
        });

        rocks.click(function(){
            if(mixingdrinksandchanginglives == false){
            } else {
                if(mix.indexOf("Rocks") >= 0 ){
                    mix.splice(mix.indexOf("Rocks"));
                    console.log(mix);
                } else {
                    mix.push("Rocks");
                    console.log(mix);
                }
            }
        });

        age.click(function(){
            if(mixingdrinksandchanginglives == false){
            } else {
                if(mix.indexOf("Age") >= 0 ){
                    mix.splice(mix.indexOf("Age"));
                    console.log(mix);
                } else {
                    mix.push("Age");
                    console.log(mix);
                }
            }
        });

        blend.click(function(){
            if(mixingdrinksandchanginglives == false){
            } else {
                if(mix.indexOf("Blend") >= 0 ){
                    mix.splice(mix.indexOf("Blend"));
                    console.log(mix);
                } else {
                    mix.push("Blend");
                    console.log(mix);
                }
            }
        });

//        Does the actual comparison to see if the current mix matches any recipes.

        mixer.click(function(){
            if(mixingdrinksandchanginglives == false){
            } else if(mix == []){
            } else {
                mix.push("Mixed");
                var result = false;
                mix.sort();
                for(i = 0; i < recipes.length; i++){
                    if(recipes[i].recipe.toString() == mix.toString()){
                        alert("You made a " + recipes[i].name + "! Good work!");
                        result = true;
                        break;
                    }
                }
                if (result == false){
                    alert("You messed it up!");
                    console.log(mix);
                    mix = [];
                }
            }
        });
</script>
</body>
</html>